---
title: "The efect of even space in visual system"
author: <br>Lu-Yi Wang^1^, Devi Stuart-Fox^1^, Geoff Walker^1^, Nicholas W. Roberts^2^
  and Amanda Franklin^1^ <br></br> ^1^School of Biosciences, The University of Melbourne,
  Australia <br></br> ^2^School of Biological Sciences, University of Bristol, UK
  <br></br>
output:
  pdf_document: default
  html_document:
    theme: flatly
    toc: true
    toc_depth: 2
subtitle: Supplementary Information
Date: May 27 2020
---
#The aim

Here, we tested the effect of even spacing of sensitivities on colour discrimination in a tetrachromatic visual system. Specifically, we ran visual models with __an evenly spaced visual system__ and __an unevenly spaced visual system__, then compared spectral contrast in all three comparison groups (‘leaf vs. flower’, ‘leaf vs. beetle’, ‘beetle vs. flower’). 
</br>
</br>
These two visual systems have the same upper and lower sensitivities with varying distribution of the two middle sensitivities. The evenly spaced visual system has peak sensitivities at 380 nm, 480 nm, 580 nm, and 680 nm, while Vis 680 is used to represent the unevenly spaced visual system, with peak sensitivities at 380 nm, 460 nm, 520 nm, and 680 nm. 
</br>
</br>
The model parameters and the statistical methods remain the same as described in the main text.

```{r, warning=FALSE,echo=FALSE,message=FALSE, results='hide'}
library(pavo)
library(dplyr)
library(stringr)
library(tidyr) #for gather() function
library(ggplot2)
library(lme4)
library(car)
library(multcomp)
library(boot) #for mean() function
library(pander) #for creating tidy tables
library(ggpubr) #for ggarrange() function
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE) # Suppress warnings in the HTML output
knitr::opts_chunk$set(cache=TRUE, warning = F) # set up cacheing to save time when re-building the html document
```

```{r import data,echo=FALSE,message=FALSE, warning=FALSE}
#import sensitivity curves
even.space <- read.csv("data/peak sensitivity even space.csv",header=TRUE) %>%
  as.rspec()
# sensmodel(c(380,480,580,680),range = c(300, 800),
#                    lambdacut = NULL,beta=TRUE,
#                    oiltype = NULL, om = NULL) %>% as.rspec()
specsensbuprest.model2 <- read.csv("data/peak sensitivity for visual model 2.csv",header=TRUE) %>%
  as.rspec()
#import irradiance
irradiance.d65 <- read.csv("data/d65.csv",header=TRUE) %>% 
  as.rspec(lim=c(300,800)) %>%  #set import range
  procspec(opt = c("min", "max")) #standardize the illumination spectrum
irradiance.twilight <- read.csv("data/civil twilight.csv",header=TRUE) %>% 
  as.rspec(lim=c(300,800)) %>% 
  procspec(opt = c("min", "max")) %>% 
  rename( twilight = Irradiance) 

#import backgound - average leaf
aveleaf <- read.csv("data/aveleaf.csv",header=TRUE) %>% as.rspec()

#import and combind beetle, flower, leaf together
raw.dataset<-read.csv("data/pooled_spec_2019.csv",header=TRUE) %>% as.rspec()
dataset<- aggspec(raw.dataset, by = 3, FUN = mean) %>%  #average three measurements to a representative one
  procspec(opt = "smooth", span = 0.1, fixneg = "zero") #smooth the spectra and lift <0 to 0
```

```{r, fig.cap="Reflectance spectra of the targets",echo=FALSE,message=FALSE, warning=FALSE,fig.show='hide'}
#import spectral reflectance
#assign categoryies to each spectrum
category.list <- c("flower","leaf","beetle")
category <- rep(category.list , c(47*501,46*501,37*501))
wavelength<-rep(dataset[,1])

#transform the data for ploting purpose
dataset.transpose<-gather(dataset[,2:131], key = "species", value = "reflectance", na.rm = FALSE,
                          convert = FALSE, factor_key = FALSE)
dataset.plot.indivisually<-cbind(dataset.transpose, wavelength,category)

#split data by categories for future use
flower.spec<-dataset.plot.indivisually[1:23547,]
leaf.spec<-dataset.plot.indivisually[23548:46593,]
beetle.spec<-dataset.plot.indivisually[46594:65130,]

#merge the spectra before plot here
dataset.plot.indivisually$category2<-factor(dataset.plot.indivisually$category, levels=c("leaf","flower","beetle"))

#plot the spectra of the targets used in this model
ggplot(dataset.plot.indivisually,aes(x=wavelength,y=reflectance, colour=category2, group=species))+
  geom_point(size=.05)+
  geom_line(size=.05)+
  theme(legend.position = "none")+
  scale_color_manual( values = c( "forestgreen", "palevioletred1","cornflowerblue"))+
  facet_grid(category2 ~ .)+
  xlab("Wavelength (nm)")+ylab("Reflectance (%)")+
  theme_classic()+
  guides(colour=FALSE) # remove the legend
```

```{r, fig.cap="Relative irradiance of the standard daylight and twilight",echo=FALSE,message=FALSE, warning=FALSE,fig.show='hide'}
#import illumination
illum <- merge(irradiance.d65, irradiance.twilight) %>% gather(light, illuminace, -wl) 

ggplot(illum, aes(x=wl, y=illuminace, color=light))+
geom_line()+
xlab("Wavelength (nm)")+
ylab("Relative irradiance")+
theme_classic()
```

```{r, fig.cap="Sensitivity curves of the even spaced visual system and the unvenspaced visual system (Vis 680).",echo=FALSE,message=FALSE, warning=FALSE}
#plot the visual systems
system.list <- c("even space","uneven space")
system.type <- rep(system.list , c(1*501,1*501))
visevencurve<-even.space %>%  rename( UVS = 2, SWS = 3, MWS = 4, LWS = 5)
vis680curve<-specsensbuprest.model2[,c(1,2,3,4,10)] %>%  rename( UVS = 2, SWS = 3, MWS = 4, LWS = 5)
combine.curves <- visevencurve %>%  rbind(vis680curve) %>% cbind(system.type) %>%
  gather( peak, value, -wl, -system.type) 

ggplot(combine.curves,aes(x=wl, y=value, linetype=system.type, color=peak))+
  geom_line()+
  guides(color=guide_legend(title="peak sensitivity", reverse=TRUE),
         linetype=guide_legend(title="system type"))+
  scale_color_manual(
    values = c("red4","olivedrab4", "dodgerblue3", "darkorchid4"),
    labels = c("LWS", "MWS", "SWS", "UVS"))+
  xlab("Wavelength (nm)")+ 
  ylab("Relative spectral sensitivity")+
  theme_classic()

# plot(even.space, lwd = 2, ylab = "Absorbance") <- used when using sensmodel() to create visual system
```


</br>
</br>

#Data description

We used the same spectral data of the beetles and plants as in the main models (see "Main models").

</br>
</br>

#Run the visual models

</br>
</br>

##First: Quantum catch calculation
* We calculated quantum catch of each visual system based on Fechner's law (the signal of the receptor channel is proportional to the logarithm of the quantum catch).
* The average leaf was used for the background.
* von Kries chromatic adaptation was applied to correct the colour.
```{r,echo=FALSE,message=FALSE, warning=FALSE}

#Quantum catch - D65
buprest.even.space.d65=vismodel(dataset[1:501,], visual = even.space, bkg=aveleaf$aveleaf, illum = irradiance.d65[1:501,2], qcatch = 'fi', relative=FALSE, vonkries=TRUE)

#Quantum catch - twilight
buprest.even.space.twilight=vismodel(dataset[1:501,], visual = even.space, bkg=aveleaf$aveleaf, illum = irradiance.twilight[1:501,2], qcatch = 'fi', relative=FALSE, vonkries=TRUE)


#Vis680
buprest680=vismodel(dataset[1:501,], visual = specsensbuprest.model2[, c(1,2,3,4,10)], bkg=aveleaf$aveleaf, illum = irradiance.d65[1:501,2], qcatch = 'fi', relative=FALSE, vonkries=TRUE)
buprest680_twilight=vismodel(dataset[1:501,], visual = specsensbuprest.model2[, c(1,2,3,4,10)], bkg=aveleaf$aveleaf, illum = irradiance.twilight[1:501,2], qcatch = 'fi', relative=FALSE, vonkries=TRUE)
```


</br>
</br>

##Second: Contrast calculation {.tabset .tabset-fade .tabset-pills}
* We used a neural noise-limited model where the noise is proportional to the Weber fraction and is independent of the intensity of the signal received.
* Photoreceptor density is based on the opisn gene epxression of Emerald ash borer, _Agrilus planipennis_: 1.14, 1, 1.26, 1.38
* The Weber fraction was asinged to be 0.1

</br>
</br>

```{r,echo=FALSE,message=FALSE, warning=FALSE}
#Contrast calculation- D65 
Cbuprest.even.space.d65 = coldist(buprest.even.space.d65, noise="neural", achro=FALSE, n = c(1.14,1,1.26,1.38), weber = 0.1, weber.ref = 4)

#Contrast calculation- twilight
Cbuprest.even.space.twilight = coldist(buprest.even.space.twilight, noise="neural", achro=FALSE, n = c(1.14,1,1.26,1.38), weber = 0.1, weber.ref = 4)

#Vis680
Cbuprest680 = coldist(buprest680, noise="neural", achro=FALSE, n = c(1.14,1,1.26,1.38), weber = 0.1, weber.ref = 4)
Cbuprest680_twilight = coldist(buprest680_twilight, noise="neural", achro=FALSE, n = c(1.14,1,1.26,1.38), weber = 0.1, weber.ref = 4)
```

```{r,echo=FALSE,message=FALSE, warning=FALSE}
#combine all contrast value in each comparison group

#Daylight
##flower vs leaf
Vis.lf_d65.even.space<- Cbuprest.even.space.d65%>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"leaves"))
Vis.lf_d65.even.space$vissys<-strrep("Vis1.lf",1)

##beetle vs leaf
Vis.lb_d65.even.space<- Cbuprest.even.space.d65%>% filter(str_detect(patch2,"beetle")) %>% 
  filter(str_detect(patch1,"leaves"))
Vis.lb_d65.even.space$vissys<-strrep("Vis1.lb",1)

##beetle vs flower
Vis.bf_d65.even.space<- Cbuprest.even.space.d65%>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"beetle"))
Vis.bf_d65.even.space$vissys<-strrep("Vis1.bf",1)

##Twiligth - model 2
##flower vs leaf
Vis.lf_twilight.even.space<- Cbuprest.even.space.twilight %>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"leaves"))
Vis.lf_twilight.even.space$vissys<-strrep("Vis1.lf",1)

##beetle vs leaf
Vis.lb_twilight.even.space<- Cbuprest.even.space.twilight %>% filter(str_detect(patch2,"beetle")) %>% 
  filter(str_detect(patch1,"leaves"))
Vis.lb_twilight.even.space$vissys<-strrep("Vis1.lb",1)

##beetle vs flower
Vis.bf_twilight.even.space<- Cbuprest.even.space.twilight %>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"beetle"))
Vis.bf_twilight.even.space$vissys<-strrep("Vis1.bf",1)

#Vis680
Vis6.lf_d65.model2<-Cbuprest680%>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"leaves"))
Vis6.lf_d65.model2$vissys<-strrep("Vis6.lf",1)
Vis6.lb_d65.model2<-Cbuprest680%>% filter(str_detect(patch2,"beetle")) %>% 
  filter(str_detect(patch1,"leaves"))
Vis6.lb_d65.model2$vissys<-strrep("Vis6.lb",1)
Vis6.bf_d65.model2<-Cbuprest680%>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"beetle"))
Vis6.bf_d65.model2$vissys<-strrep("Vis6.bf",1)
Vis6.lf_twilight.model2<-Cbuprest680_twilight %>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"leaves"))
Vis6.lf_twilight.model2$vissys<-strrep("Vis6.lf",1)
Vis6.lb_twilight.model2<-Cbuprest680_twilight %>% filter(str_detect(patch2,"beetle")) %>% 
  filter(str_detect(patch1,"leaves"))
Vis6.lb_twilight.model2$vissys<-strrep("Vis6.lb",1)
Vis6.bf_twilight.model2<-Cbuprest680_twilight %>% filter(str_detect(patch1,"flower")) %>% 
  filter(str_detect(patch2,"beetle"))
Vis6.bf_twilight.model2$vissys<-strrep("Vis6.bf",1)

```

The table shows the median contrast in each comparison group
```{r,echo=FALSE,message=FALSE, warning=FALSE}
system.list.even.space<- rbind.data.frame("even space", "Vis 680") %>% rename(system = 1) # make a list of system names
```

###Daylight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
#Daylight
##list contrast from each comparison group
lf.contrast_d65.even.space <-rbind.data.frame(median(Vis.lf_d65.even.space$dS),median(Vis6.lf_d65.model2$dS))
lb.contrast_d65.even.space<-rbind.data.frame(median(Vis.lb_d65.even.space$dS),median(Vis6.lb_d65.model2$dS))
bf.contrast_d65.even.space <-rbind.data.frame(median(Vis.bf_d65.even.space$dS),median(Vis6.bf_d65.model2$dS))


#combind comparison groups together in a table
contrast.list_d65.even.space <- system.list.even.space %>% cbind(lf.contrast_d65.even.space) %>% cbind(lb.contrast_d65.even.space) %>% cbind(bf.contrast_d65.even.space) %>% dplyr:: rename(leaf.vs.flower = 2, leaf.vs.beetle = 3, beetle.vs.flower = 4) %>% pander() 
contrast.list_d65.even.space
```

</br>
</br>

###Twilight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
#Twilight
##list contrast from each comparison group
lf.contrast_twilight.even.space <- rbind.data.frame(median(Vis.lf_twilight.even.space$dS),median(Vis6.lf_twilight.model2$dS))
lb.contrast_twilight.even.space <- rbind.data.frame(median(Vis.lb_twilight.even.space$dS),median(Vis6.lb_twilight.model2$dS))
bf.contrast_twilight.even.space <- rbind.data.frame(median(Vis.bf_twilight.even.space$dS),median(Vis6.bf_twilight.model2$dS))

#combind comparison groups together in a table
contrast.list_twilight.even.space <- system.list.even.space %>% cbind(lf.contrast_twilight.even.space) %>% cbind(lb.contrast_twilight.even.space) %>% cbind(bf.contrast_twilight.even.space) %>% dplyr:: rename(leaf.vs.flower = 2, leaf.vs.beetle = 3, beetle.vs.flower = 4) %>% pander() 
contrast.list_twilight.even.space
```

</br>
</br>

#Compare contrasts
* To compare contrasts between visual systems, We performed Wald chisquare tests on general linear mixed models (GLMM) followed by posthoc tests.

* In the models, we assigned
    + Indenpendent variable: __contrast__
    + Dependent variable: 
        + Fixed factor: __visual system__
        + Random factor: __sample ID__ of both targets in the comparison

```{r,echo=FALSE,message=FALSE, warning=FALSE} 
#creat different comparison groups for furthur GLMM analysis
#Organize data before GLMM

#D65
##flower vs leaf
Cbuprest.even.space.leaf.vs.flower=
  Cbuprest.even.space.d65 %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "leaves"))
Cbuprest680.leaf.vs.flower=
  Cbuprest680 %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "leaves"))

Cbuprest.leaf.vs.flower.even.space.Vis680=
  Cbuprest.even.space.leaf.vs.flower %>% rbind(Cbuprest680.leaf.vs.flower) 

bup.even.space.leaf.vs.flower<-Cbuprest.even.space.leaf.vs.flower[,3]
bup680.leaf.vs.flower<-Cbuprest680.leaf.vs.flower[,3]

com.bupcontrast.leaf.vs.flower.even.space<-cbind(Cbuprest.leaf.vs.flower.even.space.Vis680[,1:2],bup.even.space.leaf.vs.flower,bup680.leaf.vs.flower)
compare.leaf.vs.flower.even.space <- com.bupcontrast.leaf.vs.flower.even.space %>%
  gather(key = "peak_wl.leaf.vs.flower", value = "dS", 3:4)

##beetle vs leaf
Cbuprest.even.space.leaf.vs.beetle=
  Cbuprest.even.space.d65 %>%filter(str_detect(patch1, "leaves")) %>% filter(str_detect(patch2, "beetle"))
Cbuprest680.leaf.vs.beetle=
  Cbuprest680 %>%filter(str_detect(patch1, "leaves")) %>% filter(str_detect(patch2, "beetle"))

Cbuprest.leaf.vs.beetle.even.space.Vis680=
  Cbuprest.even.space.leaf.vs.beetle %>% rbind(Cbuprest680.leaf.vs.beetle)

bup.even.space.leaf.vs.beetle<-Cbuprest.even.space.leaf.vs.beetle[,3]
bup680.leaf.vs.beetle<-Cbuprest680.leaf.vs.beetle[,3]

com.bupcontrast.leaf.vs.beetle.even.space<-cbind(Cbuprest.leaf.vs.beetle.even.space.Vis680[,1:2],bup.even.space.leaf.vs.beetle,bup680.leaf.vs.beetle)
compare.leaf.vs.beetle.even.space <- com.bupcontrast.leaf.vs.beetle.even.space %>%
  gather(key = "peak_wl.leaf.vs.beetle", value = "dS", 3:4)

##beetle vs flower
Cbuprest.even.space.flower.vs.beetle=
  Cbuprest.even.space.d65 %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "beetle"))
Cbuprest680.flower.vs.beetle=
  Cbuprest680 %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "beetle"))

Cbuprest.flower.vs.beetle.even.space.Vis680=
  Cbuprest.even.space.flower.vs.beetle %>%  rbind(Cbuprest680.flower.vs.beetle)

bup.even.space.flower.vs.beetle<-Cbuprest.even.space.flower.vs.beetle[,3]
bup680.flower.vs.beetle<-Cbuprest680.flower.vs.beetle[,3]

com.bupcontrast.flower.vs.beetle.even.space<-cbind(Cbuprest.flower.vs.beetle.even.space.Vis680[,1:2],bup.even.space.flower.vs.beetle,bup680.flower.vs.beetle)
compare.flower.vs.beetle.even.space <- com.bupcontrast.flower.vs.beetle.even.space %>%
  gather(key = "peak_wl.flower.vs.beetle", value = "dS", 3:4)


#Twilight
##flower vs leaf
Cbuprest.even.space.leaf.vs.flower_twilight=
  Cbuprest.even.space.twilight %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "leaves"))
Cbuprest680.leaf.vs.flower_twilight=
  Cbuprest680_twilight %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "leaves"))

Cbuprest.leaf.vs.flower.even.space.Vis680.twilight=
  Cbuprest.even.space.leaf.vs.flower_twilight %>% rbind(Cbuprest680.leaf.vs.flower_twilight) 

bup.even.space.leaf.vs.flower_twilight<-Cbuprest.even.space.leaf.vs.flower_twilight[,3]
bup680.leaf.vs.flower_twilight<-Cbuprest680.leaf.vs.flower_twilight[,3]

com.bupcontrast.leaf.vs.flower.even.space_twilight<-cbind(Cbuprest.leaf.vs.flower.even.space.Vis680.twilight[,1:2],bup.even.space.leaf.vs.flower_twilight,bup680.leaf.vs.flower_twilight)
compare.leaf.vs.flower.even.space_twilight <- com.bupcontrast.leaf.vs.flower.even.space_twilight %>%
  gather(key = "peak_wl.leaf.vs.flower", value = "dS", 3:4)

##beetle vs leaf
Cbuprest.even.space.leaf.vs.beetle_twilight=
  Cbuprest.even.space.twilight %>%filter(str_detect(patch1, "leaves")) %>% filter(str_detect(patch2, "beetle"))
Cbuprest680.leaf.vs.beetle_twilight=
  Cbuprest680_twilight %>%filter(str_detect(patch1, "leaves")) %>% filter(str_detect(patch2, "beetle"))

Cbuprest.leaf.vs.beetler.even.space.Vis680.twilight=
  Cbuprest.even.space.leaf.vs.beetle_twilight  %>%  rbind(Cbuprest680.leaf.vs.beetle_twilight)

bup.even.space.leaf.vs.beetle_twilight<-Cbuprest.even.space.leaf.vs.beetle_twilight[,3]
bup680.leaf.vs.beetle_twilight<-Cbuprest680.leaf.vs.beetle_twilight[,3]

com.bupcontrast.leaf.vs.beetle.even.space_twilight<-cbind(Cbuprest.leaf.vs.beetler.even.space.Vis680.twilight[,1:2],bup.even.space.leaf.vs.beetle_twilight,bup680.leaf.vs.beetle_twilight)
compare.leaf.vs.beetle.even.space_twilight <- com.bupcontrast.leaf.vs.beetle.even.space_twilight %>%
  gather(key = "peak_wl.leaf.vs.beetle", value = "dS", 3:4)

##beetle vs flower
Cbuprest.even.space.flower.vs.beetle_twilight=
  Cbuprest.even.space.twilight %>% filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "beetle"))
Cbuprest680.flower.vs.beetle_twilight=
  Cbuprest680_twilight %>%filter(str_detect(patch1, "flower")) %>% filter(str_detect(patch2, "beetle"))

Cbuprest.flower.vs.beetle.even.space.Vis680.twilight=
  Cbuprest.even.space.flower.vs.beetle_twilight %>% rbind(Cbuprest680.flower.vs.beetle_twilight)

bup.even.space.flower.vs.beetle_twilight<-Cbuprest.even.space.flower.vs.beetle_twilight[,3]
bup680.flower.vs.beetle_twilight<-Cbuprest680.flower.vs.beetle_twilight[,3]

com.bupcontrast.flower.vs.beetle.even.space_twilight<-cbind(Cbuprest.flower.vs.beetle.even.space.Vis680.twilight[,1:2],bup.even.space.flower.vs.beetle_twilight,bup680.flower.vs.beetle_twilight)
compare.flower.vs.beetle.even.space_twilight <- com.bupcontrast.flower.vs.beetle.even.space_twilight %>%
  gather(key = "peak_wl.flower.vs.beetle", value = "dS", 3:4)

```

</br>

```{r,echo=FALSE,message=FALSE, warning=FALSE}
#GLMM - D65 - visual model 1
##Leaf vs Flower
m.leaf.vs.flower_d65.even.space <- lmer(dS~peak_wl.leaf.vs.flower + (1|patch2) + (1|patch1), data = compare.leaf.vs.flower.even.space,REML=F)
sum.leaf.vs.flower_d65.even.space<-summary(glht(m.leaf.vs.flower_d65.even.space, linfct = mcp(peak_wl.leaf.vs.flower = "Tukey")), test = adjusted("bonferroni"))
#REML=F, in order to fit the model using the likelihood ratio test. Otherwise, the lmer default will fit the model using the REML (REstricted Maximum Likelihood) criterion.

##Leaf vs Beetle
m.leaf.vs.beetle_d65.even.space <- lmer(dS~peak_wl.leaf.vs.beetle + (1|patch2) + (1|patch1), data = compare.leaf.vs.beetle.even.space,REML=F)
sum.leaf.vs.beetle_d65.even.space <- summary(glht(m.leaf.vs.beetle_d65.even.space, linfct = mcp(peak_wl.leaf.vs.beetle = "Tukey")), test = adjusted("bonferroni"))

##Beetle vs Flower
m.flower.vs.beetle_d65.even.space<- lmer(dS~peak_wl.flower.vs.beetle + (1|patch2) + (1|patch1), data = compare.flower.vs.beetle.even.space,REML=F)
sum.flower.vs.beetle_d65.even.space <-summary(glht(m.flower.vs.beetle_d65.even.space, linfct = mcp(peak_wl.flower.vs.beetle = "Tukey")), test = adjusted("bonferroni"))


#GLMM - Twilight - visual model 2
##Leaf vs Flower
m.leaf.vs.flower_twilight.even.space <- lmer(dS~peak_wl.leaf.vs.flower + (1|patch2) + (1|patch1), data = compare.leaf.vs.flower.even.space_twilight ,REML=F)
sum.leaf.vs.flower_twilight.even.space  <- summary(glht(m.leaf.vs.flower_twilight.even.space , linfct = mcp(peak_wl.leaf.vs.flower = "Tukey")), test = adjusted("bonferroni"))
##Leaf vs Beetle
m.leaf.vs.beetle_twilight.even.space <- lmer(dS~peak_wl.leaf.vs.beetle + (1|patch2) + (1|patch1), data = compare.leaf.vs.beetle.even.space_twilight ,REML=F)
sum.leaf.vs.beetle_twilight.even.space  <- summary(glht(m.leaf.vs.beetle_twilight.even.space , linfct = mcp(peak_wl.leaf.vs.beetle = "Tukey")), test = adjusted("bonferroni"))
##Beetle vs Flower
m.flower.vs.beetle_twilight.even.space  <- lmer(dS~peak_wl.flower.vs.beetle + (1|patch2) + (1|patch1), data = compare.flower.vs.beetle.even.space_twilight ,REML=F)
sum.flower.vs.beetle_twilight.even.space  <-summary(glht(m.flower.vs.beetle_twilight.even.space , linfct = mcp(peak_wl.flower.vs.beetle = "Tukey")), test = adjusted("bonferroni"))
```

### __Leaf vs Flower__ {.tabset .tabset-fade .tabset-pills}
####Daylight

```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.leaf.vs.flower_d65.even.space) %>% pander()
```

</br>
</br>


####Twilight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.leaf.vs.flower_twilight.even.space) %>% pander()
```

</br>
</br>


### __Leaf vs Beetle__ {.tabset .tabset-fade .tabset-pills}
####Daylight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.leaf.vs.beetle_d65.even.space) %>% pander()
```

</br>
</br>


####Twilight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.leaf.vs.beetle_twilight.even.space) %>% pander()
```

</br>
</br>


### __Beetle vs Flower__ {.tabset .tabset-fade .tabset-pills}
####Daylight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.flower.vs.beetle_d65.even.space) %>% pander()
```

</br>
</br>

####Twilight
```{r,echo=FALSE,message=FALSE, warning=FALSE}
Anova(m.flower.vs.beetle_twilight.even.space) %>% pander()
```

</br>
</br>


#Summary
For all three comparison groups, Vis 680 (unevenly spaced visual system) has significantly higher contrast than the evenly spaced visual system. This indicates that the minimal improvement or lack of improvement in contrast beyond 640 nm shown in the main text is not the result of uneven spacing between photoreceptors. 